#!/bin/sh
VAR=$1
JSON=$2
CPP=$3
( [ -z ${VAR} ] || [ -z ${JSON} ] || [ -z ${CPP} ] ) && echo "Invalid parameters to mkjson" && exit 1

echo "[JCH] MKJSONCALLED" >/tmp/jch.log 
echo $1 $2 $3 >> /tmp/jch.log 


cat > ${CPP} << END_WARNING

/*
 * WARNING: This is an automatically generated file.
 *          Do not edit this file.
 *          To change the content, edit the file `basename ${JSON}`
 * Generation date: `date`
 */

namespace fledge_power_s2opc_north
{

END_WARNING
/bin/echo "const char* ${VAR} = " >> ${CPP}
# Note:
# - replace \ by \\
# - replace " by \"
# - remove leading spaces
# - Replace each <line> by <"line"\>
sed 's/\\/\\\\/g' ${JSON} | sed 's/"/\\"/g' | sed 's/^ *//' | sed 's/^\(.*\)$/"\1"\\/'>> ${CPP}
/bin/echo ';' >> ${CPP}
/bin/echo '}' >> ${CPP}
