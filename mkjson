#!/bin/sh
VAR=$1
JSON=$2
CPP=$3
( [ -z ${VAR} ] || [ -z ${JSON} ] || [ -z ${CPP} ] ) && echo "Invalid parameters to mkjson" && exit 1

echo $1 $2 $3 >> /tmp/jch.log 


cat > ${CPP} << END_WARNING

/*
 * WARNING: This is an automatically generated file.
 *          Do not edit this file.
 *          To change the content, edit the file `basename ${JSON}`
 * Generation date: `date`
 */

namespace s2opc_north
{

END_WARNING
/bin/echo "const char* ${VAR} = " >> ${CPP}
# Note:
# - replace ' by \" (This aims at easing readability of json to avoid using \" within strings)
# - replace \ by \\
# - replace " by \"
# - Trim  spaces and tab. (beginning and end of line) 
# - Replace each <line> by <"line"\>
cat  ${JSON} | sed 's/^[\t ]*//g' | sed 's/[\t ]*$//g' | sed 's/\\$//g' | sed "s/'/"'\\\"'/g | sed 's/\\/\\\\/g' | sed 's/"/\\"/g'  | sed 's/^\(.*\)$/"\1"\\/'>> ${CPP}
/bin/echo ';' >> ${CPP}
/bin/echo '}' >> ${CPP}
